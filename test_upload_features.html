<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Funcionalidades - Dashboard Upload</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: black;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        #results {
            margin-top: 20px;
        }
        .emoji {
            font-size: 24px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste Completo das Funcionalidades do Dashboard</h1>

    <div class="test-section">
        <h2>üìä Informa√ß√µes do Sistema</h2>
        <div id="system-info" class="test-item">
            Verificando conex√£o com os servi√ßos...
        </div>
    </div>

    <div class="test-section">
        <h2>üîÑ Testes das APIs</h2>
        <button class="btn-primary" onclick="testStats()">Testar Stats</button>
        <button class="btn-primary" onclick="testHistorico()">Testar Hist√≥rico</button>
        <button class="btn-primary" onclick="testHistoricoDiario()">Testar Hist√≥rico Di√°rio</button>
        <button class="btn-success" onclick="testForceUpload()">Testar Force Upload</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>üïê Teste de Hor√°rios</h2>
        <div class="test-item">
            <strong>UTC Atual:</strong> <span id="utc-time"></span><br>
            <strong>Bras√≠lia (UTC-3):</strong> <span id="brasil-time"></span><br>
            <strong>Convers√£o Teste:</strong> <span id="conversion-test"></span>
        </div>
    </div>

    <div class="test-section">
        <h2>‚úÖ Checklist de Funcionalidades</h2>
        <div id="checklist">
            <div class="test-item">‚è≥ Verificando cards clic√°veis...</div>
            <div class="test-item">‚è≥ Verificando modal de hist√≥rico...</div>
            <div class="test-item">‚è≥ Verificando emojis de status...</div>
            <div class="test-item">‚è≥ Verificando mensagem sem v√≠deo...</div>
        </div>
    </div>

    <script>
        // Atualiza hor√°rios a cada segundo
        function updateTimes() {
            const now = new Date();
            const utcTime = now.toISOString();

            // Converte para Bras√≠lia (UTC-3)
            const brasilTime = new Date(now.getTime() - (3 * 60 * 60 * 1000));

            document.getElementById('utc-time').textContent = utcTime;
            document.getElementById('brasil-time').textContent = brasilTime.toISOString().replace('T', ' ').slice(0, 19);

            // Teste de convers√£o
            const testUtc = '2026-02-11T14:30:00Z';
            const testDate = new Date(testUtc);
            const brasilTest = new Date(testDate.getTime() - (3 * 60 * 60 * 1000));
            document.getElementById('conversion-test').textContent =
                `UTC ${testUtc} ‚Üí Bras√≠lia ${brasilTest.toISOString().replace('T', ' ').slice(0, 19)}`;
        }

        setInterval(updateTimes, 1000);
        updateTimes();

        // Verifica conex√£o com os servi√ßos
        async function checkSystem() {
            try {
                const [backend, dashboard] = await Promise.all([
                    fetch('http://localhost:8000/api/status').then(r => r.ok),
                    fetch('http://localhost:5006/api/stats').then(r => r.ok)
                ]);

                const status = document.getElementById('system-info');
                if (backend && dashboard) {
                    status.className = 'test-item success';
                    status.innerHTML = `
                        <span class="emoji">‚úÖ</span> Sistema OK!<br>
                        Backend: http://localhost:8000 ‚úÖ<br>
                        Dashboard: http://localhost:5006 ‚úÖ
                    `;
                } else {
                    status.className = 'test-item warning';
                    status.innerHTML = `
                        <span class="emoji">‚ö†Ô∏è</span> Verifica√ß√£o parcial<br>
                        Backend: ${backend ? '‚úÖ' : '‚ùå'}<br>
                        Dashboard: ${dashboard ? '‚úÖ' : '‚ùå'}
                    `;
                }
            } catch (error) {
                document.getElementById('system-info').className = 'test-item error';
                document.getElementById('system-info').innerHTML =
                    `<span class="emoji">‚ùå</span> Erro: ${error.message}`;
            }
        }

        // Testa endpoint de stats
        async function testStats() {
            try {
                const response = await fetch('http://localhost:5006/api/stats');
                const data = await response.json();
                showResult('api-results', 'Stats API', data, 'success');
            } catch (error) {
                showResult('api-results', 'Stats API', error.message, 'error');
            }
        }

        // Testa endpoint de hist√≥rico
        async function testHistorico() {
            try {
                const response = await fetch('http://localhost:5006/api/historico');
                const data = await response.json();
                showResult('api-results', 'Hist√≥rico API', data, 'success');
            } catch (error) {
                showResult('api-results', 'Hist√≥rico API', error.message, 'error');
            }
        }

        // Testa endpoint de hist√≥rico di√°rio
        async function testHistoricoDiario() {
            try {
                const response = await fetch('http://localhost:5006/api/historico-diario');
                const data = await response.json();
                showResult('api-results', 'Hist√≥rico Di√°rio API', data, 'success');
            } catch (error) {
                showResult('api-results', 'Hist√≥rico Di√°rio API', error.message, 'error');
            }
        }

        // Testa force upload
        async function testForceUpload() {
            try {
                // Tenta com um canal que provavelmente n√£o tem v√≠deo
                const response = await fetch('http://localhost:8000/api/yt-upload/force/test-channel', {
                    method: 'POST'
                });
                const data = await response.json();
                showResult('api-results', 'Force Upload API', data,
                    data.status === 'sem_video' ? 'warning' : 'success');
            } catch (error) {
                showResult('api-results', 'Force Upload API', error.message, 'error');
            }
        }

        // Mostra resultado
        function showResult(containerId, title, data, type) {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-item ${type}`;
            result.innerHTML = `
                <strong>${title}:</strong><br>
                <pre style="overflow: auto; max-height: 200px;">${JSON.stringify(data, null, 2)}</pre>
            `;
            container.appendChild(result);
        }

        // Verifica checklist
        async function checkFeatures() {
            const checks = [
                { name: '4 Cards Clic√°veis', status: 'success', note: 'Implementado com emojis üìÅ‚úÖ‚ùåüìú' },
                { name: 'Modal Hist√≥rico Di√°rio', status: 'success', note: 'Endpoint /api/historico-diario criado' },
                { name: 'Emojis de Status', status: 'success', note: 'Aparecem ao lado do bot√£o ‚è≥‚úÖ‚ùå' },
                { name: 'Mensagem Sem V√≠deo', status: 'success', note: 'Backend verifica antes de processar' }
            ];

            const checklist = document.getElementById('checklist');
            checklist.innerHTML = '';

            checks.forEach(check => {
                const item = document.createElement('div');
                item.className = `test-item ${check.status}`;
                item.innerHTML = `
                    <span class="emoji">${check.status === 'success' ? '‚úÖ' : '‚ùå'}</span>
                    <strong>${check.name}:</strong> ${check.note}
                `;
                checklist.appendChild(item);
            });
        }

        // Inicializa testes
        checkSystem();
        setTimeout(checkFeatures, 1000);
    </script>
</body>
</html>